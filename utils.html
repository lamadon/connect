<html>
  <head>
    <title>
      
        Connect - utils
      
    </title>
    <link rel='stylesheet' href='main.css' />
  </head>
  <body>
    <div id="content">
      
        <h1>utils</h1>
        <span class="filename">lib/utils.js</span>
      

      
      
        
        
        
        
        
          <div class="comment">
            
            <p class="description"><p>Return md5 hash of the given string and optional encoding,
defaulting to hex.</p></p>

            
              <div class="body">
                <pre><code>utils.md5(&#39;wahoo&#39;);
// =&gt; &quot;e493298061761236c96b02ea6aa8a2ad&quot;</code></pre>
              </div>
            

            
              <ul class="tags">
              
                

                

                

                
                  <li class="param"><em>param</em> <span class="types">String</span> <span class="name">str</span> <span class="description"></span></li>
                
              
                

                

                

                
                  <li class="param"><em>param</em> <span class="types">String</span> <span class="name">encoding</span> <span class="description"></span></li>
                
              
                
                  <li class="return"><em>returns</em> <span class="types">String</span></li>
                

                

                

                
              
                

                
                  <li class="api"><em>api</em> <span class="visibility">public</span></li>
                

                

                
              
              </ul>

<!--            
              <pre class="code">
                <code>
exports.md5 = function(str, encoding){
  return crypto
    .createHash('md5')
    .update(str)
    .digest(encoding || 'hex');
};
                </code>
              </pre>
             -->
          
          </div>
        
      
        
        
          <div class="comment">
            
              <h3 class="method">.merge()</h3>
            
            <p class="description"><p>Merge object b with object a.</p></p>

            
              <div class="body">
                <pre><code>var a = { foo: &#39;bar&#39; }
  , b = { bar: &#39;baz&#39; };

utils.merge(a, b);
// =&gt; { foo: &#39;bar&#39;, bar: &#39;baz&#39; }</code></pre>
              </div>
            

            
              <ul class="tags">
              
                

                

                

                
                  <li class="param"><em>param</em> <span class="types">Object</span> <span class="name">a</span> <span class="description"></span></li>
                
              
                

                

                

                
                  <li class="param"><em>param</em> <span class="types">Object</span> <span class="name">b</span> <span class="description"></span></li>
                
              
                
                  <li class="return"><em>returns</em> <span class="types">Object</span></li>
                

                

                

                
              
                

                
                  <li class="api"><em>api</em> <span class="visibility">public</span></li>
                

                

                
              
              </ul>

<!--            
              <pre class="code">
                <code>
exports.merge = function(a, b){
  if (a && b) {
    for (var key in b) {
      a[key] = b[key];
    }
  }
  return a;
};
                </code>
              </pre>
             -->
          
          </div>
        
      
        
        
          <div class="comment">
            
              <h3 class="method">.escape()</h3>
            
            <p class="description"><p>Escape the given string of <code>html</code>.</p></p>

            

            
              <ul class="tags">
              
                

                

                

                
                  <li class="param"><em>param</em> <span class="types">String</span> <span class="name">html</span> <span class="description"></span></li>
                
              
                
                  <li class="return"><em>returns</em> <span class="types">String</span></li>
                

                

                

                
              
                

                
                  <li class="api"><em>api</em> <span class="visibility">public</span></li>
                

                

                
              
              </ul>

<!--            
              <pre class="code">
                <code>
exports.escape = function(html){
  return String(html)
    .replace(/&(?!\w+;)/g, '&amp;')
    .replace(/</g, '&lt;')
    .replace(/>/g, '&gt;')
    .replace(/"/g, '&quot;');
};
                </code>
              </pre>
             -->
          
          </div>
        
      
        
        
          <div class="comment">
            
              <h3 class="method">.uid()</h3>
            
            <p class="description"><p>Return a unique identifier with the given <code>len</code>.</p></p>

            
              <div class="body">
                <pre><code>utils.uid(10);
// =&gt; &quot;FDaS435D2z&quot;</code></pre>
              </div>
            

            
              <ul class="tags">
              
                

                

                

                
                  <li class="param"><em>param</em> <span class="types">Number</span> <span class="name">len</span> <span class="description"></span></li>
                
              
                
                  <li class="return"><em>returns</em> <span class="types">String</span></li>
                

                

                

                
              
                

                
                  <li class="api"><em>api</em> <span class="visibility">public</span></li>
                

                

                
              
              </ul>

<!--            
              <pre class="code">
                <code>
exports.uid = function(len) {
  var buf = []
    , chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789'
    , charlen = chars.length;

  for (var i = 0; i < len; ++i) {
    buf.push(chars[getRandomInt(0, charlen - 1)]);
  }

  return buf.join('');
};
                </code>
              </pre>
             -->
          
          </div>
        
      
        
        
          <div class="comment">
            
              <h3 class="method">.undefined()</h3>
            
            <p class="description"><p>Parse the given cookie string into an object.</p></p>

            

            
              <ul class="tags">
              
                

                

                

                
                  <li class="param"><em>param</em> <span class="types">String</span> <span class="name">str</span> <span class="description"></span></li>
                
              
                
                  <li class="return"><em>returns</em> <span class="types">Object</span></li>
                

                

                

                
              
                

                
                  <li class="api"><em>api</em> <span class="visibility">public</span></li>
                

                

                
              
              </ul>

<!--             -->
          
          </div>
        
      
        
        
        
          <div class="comment">
            
              <h3 class="method">.serializeCookie()</h3>
            
            <p class="description"><p>Serialize the given object into a cookie string.</p></p>

            
              <div class="body">
                <pre><code> utils.serializeCookie(&#39;name&#39;, &#39;tj&#39;, { httpOnly: true })
 // =&gt; &quot;name=tj; httpOnly&quot;</code></pre>
              </div>
            

            
              <ul class="tags">
              
                

                

                

                
                  <li class="param"><em>param</em> <span class="types">String</span> <span class="name">name</span> <span class="description"></span></li>
                
              
                

                

                

                
                  <li class="param"><em>param</em> <span class="types">String</span> <span class="name">val</span> <span class="description"></span></li>
                
              
                

                

                

                
                  <li class="param"><em>param</em> <span class="types">Object</span> <span class="name">obj</span> <span class="description"></span></li>
                
              
                
                  <li class="return"><em>returns</em> <span class="types">String</span></li>
                

                

                

                
              
                

                
                  <li class="api"><em>api</em> <span class="visibility">public</span></li>
                

                

                
              
              </ul>

<!--            
              <pre class="code">
                <code>
exports.serializeCookie = function(name, val, obj){
  var pairs = [name + '=' + encodeURIComponent(val)]
    , obj = obj || {};

  if (obj.domain) pairs.push('domain=' + obj.domain);
  if (obj.path) pairs.push('path=' + obj.path);
  if (obj.expires) pairs.push('expires=' + obj.expires.toUTCString());
  if (obj.httpOnly) pairs.push('httpOnly');
  if (obj.secure) pairs.push('secure');

  return pairs.join('; ');
};
                </code>
              </pre>
             -->
          
          </div>
        
      
        
        
          <div class="comment">
            
              <h3 class="method">.pause()</h3>
            
            <p class="description"><p>Pause <code>data</code> and <code>end</code> events on the given <code>obj</code>.
Middleware performing async tasks <em>should</em> utilize
this utility (or similar), to re-emit data once
the async operation has completed, otherwise these
events may be lost.</p></p>

            
              <div class="body">
                <pre><code> var pause = utils.pause(req);
 fs.readFile(path, function(){
    next();
    pause.resume();
 });</code></pre>
              </div>
            

            
              <ul class="tags">
              
                

                

                

                
                  <li class="param"><em>param</em> <span class="types">Object</span> <span class="name">obj</span> <span class="description"></span></li>
                
              
                
                  <li class="return"><em>returns</em> <span class="types">Object</span></li>
                

                

                

                
              
                

                
                  <li class="api"><em>api</em> <span class="visibility">public</span></li>
                

                

                
              
              </ul>

<!--            
              <pre class="code">
                <code>
exports.pause = function(obj){
  var onData
    , onEnd
    , events = [];

  // buffer data
  obj.on('data', onData = function(data, encoding){
    events.push(['data', data, encoding]);
  });

  // buffer end
  obj.on('end', onEnd = function(data, encoding){
    events.push(['end', data, encoding]);
  });

  return {
    end: function(){
      obj.removeListener('data', onData);
      obj.removeListener('end', onEnd);
    },
    resume: function(){
      this.end();
      for (var i = 0, len = events.length; i < len; ++i) {
        obj.emit.apply(obj, events[i]);
      }
    }
  };
};
                </code>
              </pre>
             -->
          
          </div>
        
      
        
        
          <div class="comment">
            
              <h3 class="method">.undefined()</h3>
            
            <p class="description"><p>Check <code>req</code> and <code>res</code> to see if it has been modified.</p></p>

            

            
              <ul class="tags">
              
                

                

                

                
                  <li class="param"><em>param</em> <span class="types">IncomingMessage</span> <span class="name">req</span> <span class="description"></span></li>
                
              
                

                

                

                
                  <li class="param"><em>param</em> <span class="types">ServerResponse</span> <span class="name">res</span> <span class="description"></span></li>
                
              
                
                  <li class="return"><em>returns</em> <span class="types">Boolean</span></li>
                

                

                

                
              
                

                
                  <li class="api"><em>api</em> <span class="visibility">public</span></li>
                

                

                
              
              </ul>

<!--             -->
          
          </div>
        
      
        
        
        
          <div class="comment">
            
              <h3 class="method">.removeContentHeaders()</h3>
            
            <p class="description"><p>Strip <code>Content-*</code> headers from <code>res</code>.</p></p>

            

            
              <ul class="tags">
              
                

                

                

                
                  <li class="param"><em>param</em> <span class="types">ServerResponse</span> <span class="name">res</span> <span class="description"></span></li>
                
              
                

                
                  <li class="api"><em>api</em> <span class="visibility">public</span></li>
                

                

                
              
              </ul>

<!--            
              <pre class="code">
                <code>
exports.removeContentHeaders = function(res){
  Object.keys(res._headers).forEach(function(field){
    if (0 == field.indexOf('content')) {
      res.removeHeader(field);
    }
  });
};
                </code>
              </pre>
             -->
          
          </div>
        
      
        
        
          <div class="comment">
            
              <h3 class="method">.conditionalGET()</h3>
            
            <p class="description"><p>Check if <code>req</code> is a conditional GET request.</p></p>

            

            
              <ul class="tags">
              
                

                

                

                
                  <li class="param"><em>param</em> <span class="types">IncomingMessage</span> <span class="name">req</span> <span class="description"></span></li>
                
              
                
                  <li class="return"><em>returns</em> <span class="types">Boolean</span></li>
                

                

                

                
              
                

                
                  <li class="api"><em>api</em> <span class="visibility">public</span></li>
                

                

                
              
              </ul>

<!--            
              <pre class="code">
                <code>
exports.conditionalGET = function(req) {
  return req.headers['if-modified-since']
    || req.headers['if-none-match'];
};
                </code>
              </pre>
             -->
          
          </div>
        
      
        
        
          <div class="comment">
            
              <h3 class="method">.forbidden()</h3>
            
            <p class="description"><p>Respond with 403 &quot;Forbidden&quot;.</p></p>

            

            
              <ul class="tags">
              
                

                

                

                
                  <li class="param"><em>param</em> <span class="types">ServerResponse</span> <span class="name">res</span> <span class="description"></span></li>
                
              
                

                
                  <li class="api"><em>api</em> <span class="visibility">public</span></li>
                

                

                
              
              </ul>

<!--            
              <pre class="code">
                <code>
exports.forbidden = function(res) {
  var body = 'Forbidden';
  res.setHeader('Content-Type', 'text/plain');
  res.setHeader('Content-Length', body.length);
  res.statusCode = 403;
  res.end(body);
};
                </code>
              </pre>
             -->
          
          </div>
        
      
        
        
          <div class="comment">
            
              <h3 class="method">.unauthorized()</h3>
            
            <p class="description"><p>Respond with 401 &quot;Unauthorized&quot;.</p></p>

            

            
              <ul class="tags">
              
                

                

                

                
                  <li class="param"><em>param</em> <span class="types">ServerResponse</span> <span class="name">res</span> <span class="description"></span></li>
                
              
                

                

                

                
                  <li class="param"><em>param</em> <span class="types">String</span> <span class="name">realm</span> <span class="description"></span></li>
                
              
                

                
                  <li class="api"><em>api</em> <span class="visibility">public</span></li>
                

                

                
              
              </ul>

<!--            
              <pre class="code">
                <code>
exports.unauthorized = function(res, realm) {
  res.statusCode = 401;
  res.setHeader('WWW-Authenticate', 'Basic realm="' + realm + '"');
  res.end('Unauthorized');
};
                </code>
              </pre>
             -->
          
          </div>
        
      
        
        
          <div class="comment">
            
              <h3 class="method">.badRequest()</h3>
            
            <p class="description"><p>Respond with 400 &quot;Bad Request&quot;.</p></p>

            

            
              <ul class="tags">
              
                

                

                

                
                  <li class="param"><em>param</em> <span class="types">ServerResponse</span> <span class="name">res</span> <span class="description"></span></li>
                
              
                

                
                  <li class="api"><em>api</em> <span class="visibility">public</span></li>
                

                

                
              
              </ul>

<!--            
              <pre class="code">
                <code>
exports.badRequest = function(res) {
  res.statusCode = 400;
  res.end('Bad Request');
};
                </code>
              </pre>
             -->
          
          </div>
        
      
        
        
          <div class="comment">
            
              <h3 class="method">.notModified()</h3>
            
            <p class="description"><p>Respond with 304 &quot;Not Modified&quot;.</p></p>

            

            
              <ul class="tags">
              
                

                

                

                
                  <li class="param"><em>param</em> <span class="types">ServerResponse</span> <span class="name">res</span> <span class="description"></span></li>
                
              
                

                

                

                
                  <li class="param"><em>param</em> <span class="types">Object</span> <span class="name">headers</span> <span class="description"></span></li>
                
              
                

                
                  <li class="api"><em>api</em> <span class="visibility">public</span></li>
                

                

                
              
              </ul>

<!--            
              <pre class="code">
                <code>
exports.notModified = function(res) {
  exports.removeContentHeaders(res);
  res.statusCode = 304;
  res.end();
};
                </code>
              </pre>
             -->
          
          </div>
        
      
        
        
          <div class="comment">
            
              <h3 class="method">.etag()</h3>
            
            <p class="description"><p>Return an ETag in the form of <code>&quot;&lt;size&gt;-&lt;mtime&gt;&quot;</code>
from the given <code>stat</code>.</p></p>

            

            
              <ul class="tags">
              
                

                

                

                
                  <li class="param"><em>param</em> <span class="types">Object</span> <span class="name">stat</span> <span class="description"></span></li>
                
              
                
                  <li class="return"><em>returns</em> <span class="types">String</span></li>
                

                

                

                
              
                

                
                  <li class="api"><em>api</em> <span class="visibility">public</span></li>
                

                

                
              
              </ul>

<!--            
              <pre class="code">
                <code>
exports.etag = function(stat) {
  return '"' + stat.size + '-' + Number(stat.mtime) + '"';
};
                </code>
              </pre>
             -->
          
          </div>
        
      
        
        
          <div class="comment">
            
              <h3 class="method">.parseRange()</h3>
            
            <p class="description"><p>Parse &quot;Range&quot; header <code>str</code> relative to the given file <code>size</code>.</p></p>

            

            
              <ul class="tags">
              
                

                

                

                
                  <li class="param"><em>param</em> <span class="types">Number</span> <span class="name">size</span> <span class="description"></span></li>
                
              
                

                

                

                
                  <li class="param"><em>param</em> <span class="types">String</span> <span class="name">str</span> <span class="description"></span></li>
                
              
                
                  <li class="return"><em>returns</em> <span class="types">Array</span></li>
                

                

                

                
              
                

                
                  <li class="api"><em>api</em> <span class="visibility">public</span></li>
                

                

                
              
              </ul>

<!--            
              <pre class="code">
                <code>
exports.parseRange = function(size, str){
  var valid = true;
  var arr = str.substr(6).split(',').map(function(range){
    var range = range.split('-')
      , start = parseInt(range[0], 10)
      , end = parseInt(range[1], 10);

    // -500
    if (isNaN(start)) {
      start = size - end;
      end = size - 1;
    // 500-
    } else if (isNaN(end)) {
      end = size - 1;
    }

    // Invalid
    if (isNaN(start) || isNaN(end) || start > end) valid = false;

    return { start: start, end: end };
  });
  return valid ? arr : undefined;
};
                </code>
              </pre>
             -->
          
          </div>
        
      
        
        
          <div class="comment">
            
              <h3 class="method">.parseCacheControl()</h3>
            
            <p class="description"><p>Parse the given Cache-Control <code>str</code>.</p></p>

            

            
              <ul class="tags">
              
                

                

                

                
                  <li class="param"><em>param</em> <span class="types">String</span> <span class="name">str</span> <span class="description"></span></li>
                
              
                
                  <li class="return"><em>returns</em> <span class="types">Object</span></li>
                

                

                

                
              
                

                
                  <li class="api"><em>api</em> <span class="visibility">public</span></li>
                

                

                
              
              </ul>

<!--            
              <pre class="code">
                <code>
exports.parseCacheControl = function(str){
  var directives = str.split(',')
    , obj = {};

  for(var i = 0, len = directives.length; i < len; i++) {
    var parts = directives[i].split('=')
      , key = parts.shift().trim()
      , val = parseInt(parts.shift(), 10);

    obj[key] = isNaN(val) ? true : val;
  }

  return obj;
};
                </code>
              </pre>
             -->
          
          </div>
        
      
        
        
          <div class="comment">
            
              <h3 class="method">.toArray()</h3>
            
            <p class="description"><p>Convert array-like object to an <code>Array</code>.</p></p>

            
              <div class="body">
                <p>node-bench measured &quot;16.5 times faster than Array.prototype.slice.call()&quot;</p>
              </div>
            

            
              <ul class="tags">
              
                

                

                

                
                  <li class="param"><em>param</em> <span class="types">Object</span> <span class="name">obj</span> <span class="description"></span></li>
                
              
                
                  <li class="return"><em>returns</em> <span class="types">Array</span></li>
                

                

                

                
              
                

                
                  <li class="api"><em>api</em> <span class="visibility">public</span></li>
                

                

                
              
              </ul>

<!--            
              <pre class="code">
                <code>
var toArray = exports.toArray = function(obj){
  var len = obj.length
    , arr = new Array(len);
  for (var i = 0; i < len; ++i) {
    arr[i] = obj[i];
  }
  return arr;
};
                </code>
              </pre>
             -->
          
          </div>
        
      
        
      
    </div>
  </body>
</html>